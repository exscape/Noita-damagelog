dofile_once("mods/damagelog-dev-helper/files/utils.lua")
local nxml = dofile_once("mods/damagelog-dev-helper/files/nxml.lua")

--[[
	Because (AFAIK) neither Noita nor Lua has the ability to query the filesystem, and
	getting LuaRocks + LuaFileSystem installed seems a massive pain, I decided to just not bother,
	and use a separate tool to gather the list of files.

	The reason this utility is a Noita mod to begin with is that Noita XML is not actual XML, so
	you need special tools to parse it the way the game does.
	I use the included "nxml" library for this.

	If it wasn't for the nxml requirement, this would have been a 100% python solution instead.

	To generate the following line, I used the following in WSL:
	echo 'local file_list = {' $(find entities/animals -iname '*.xml' | sort | sed -e 's#^#"data/#g' -e 's#$#",#g') '}' | clip.exe
	... executed from the unpacked Noita data directory, which was not named "data", thus the additional stuff above.
	It's simply a list of all xml files under data/entities/animals.
]]
-- Generated 2024-04-08, but on Noita's 20241801-1725 build (on GOG).
local file_list = { "data/entities/animals/acidshooter_weak.xml", "data/entities/animals/acidshooter.xml", "data/entities/animals/alchemist.xml", "data/entities/animals/ant.xml", "data/entities/animals/apparition/playerghost.xml", "data/entities/animals/assassin.xml", "data/entities/animals/barfer.xml", "data/entities/animals/basebot_hidden.xml", "data/entities/animals/basebot_neutralizer.xml", "data/entities/animals/basebot_sentry.xml", "data/entities/animals/basebot_soldier.xml", "data/entities/animals/bat.xml", "data/entities/animals/berserkspirit.xml", "data/entities/animals/bigbat.xml", "data/entities/animals/bigfirebug.xml", "data/entities/animals/bigzombiehead.xml", "data/entities/animals/bigzombietorso.xml", "data/entities/animals/bigzombie.xml", "data/entities/animals/blob.xml", "data/entities/animals/bloodcrystal_physics.xml", "data/entities/animals/bloom.xml", "data/entities/animals/boss_alchemist/boss_alchemist_sprite.xml", "data/entities/animals/boss_alchemist/boss_alchemist.xml", "data/entities/animals/boss_alchemist/countered_projectile_effect.xml", "data/entities/animals/boss_alchemist/enlightened_alchemist_boss.xml", "data/entities/animals/boss_alchemist/key_particles_first_alt.xml", "data/entities/animals/boss_alchemist/key_particles_first.xml", "data/entities/animals/boss_alchemist/key_particles_second_alt.xml", "data/entities/animals/boss_alchemist/key_particles_second.xml", "data/entities/animals/boss_alchemist/key.xml", "data/entities/animals/boss_alchemist/projectile_counter.xml", "data/entities/animals/boss_alchemist/wand_orb.xml", "data/entities/animals/boss_book/book_physics.xml", "data/entities/animals/boss_centipede/body_chunks.xml", "data/entities/animals/boss_centipede/body.xml", "data/entities/animals/boss_centipede/boss_centipede_explosion_effect.xml", "data/entities/animals/boss_centipede/boss_centipede_explosion_large.xml", "data/entities/animals/boss_centipede/boss_centipede_explosion.xml", "data/entities/animals/boss_centipede/boss_centipede_minion.xml", "data/entities/animals/boss_centipede/boss_centipede_shield_strong.xml", "data/entities/animals/boss_centipede/boss_centipede_shield_trail_effect.xml", "data/entities/animals/boss_centipede/boss_centipede_shield_weak.xml", "data/entities/animals/boss_centipede/boss_centipede.xml", "data/entities/animals/boss_centipede/boss_music_buildup_trigger.xml", "data/entities/animals/boss_centipede/boss_victoryroom_ambience.xml", "data/entities/animals/boss_centipede/boss_victoryroom_mechanism_sprite.xml", "data/entities/animals/boss_centipede/boss_victoryroom_mechanism.xml", "data/entities/animals/boss_centipede/bug_blue.xml", "data/entities/animals/boss_centipede/clear_materials_image.xml", "data/entities/animals/boss_centipede/clear_materials.xml", "data/entities/animals/boss_centipede/ending/ending_sampo_spot_mountain.xml", "data/entities/animals/boss_centipede/ending/ending_sampo_spot_underground.xml", "data/entities/animals/boss_centipede/ending/gold_effect.xml", "data/entities/animals/boss_centipede/ending/midas_chunks.xml", "data/entities/animals/boss_centipede/ending/midas_entities.xml", "data/entities/animals/boss_centipede/ending/midas_radioactive.xml", "data/entities/animals/boss_centipede/ending/midas_sand.xml", "data/entities/animals/boss_centipede/ending/midas_walls.xml", "data/entities/animals/boss_centipede/ending/midas.xml", "data/entities/animals/boss_centipede/ending/sampo_effect.xml", "data/entities/animals/boss_centipede/firepillar_part.xml", "data/entities/animals/boss_centipede/firepillar.xml", "data/entities/animals/boss_centipede/limbs/limb_long_a_green.xml", "data/entities/animals/boss_centipede/limbs/limb_long_a.xml", "data/entities/animals/boss_centipede/limbs/limb_long_b_green.xml", "data/entities/animals/boss_centipede/limbs/limb_long_b.xml", "data/entities/animals/boss_centipede/limbs/limb_long_knee_green.xml", "data/entities/animals/boss_centipede/limbs/limb_long_knee.xml", "data/entities/animals/boss_centipede/limbs/limb_long.xml", "data/entities/animals/boss_centipede/loose_lavabridge.xml", "data/entities/animals/boss_centipede/loose_lavaceiling.xml", "data/entities/animals/boss_centipede/melee.xml", "data/entities/animals/boss_centipede/minion_physics_eye.xml", "data/entities/animals/boss_centipede/minion_physics_particle.xml", "data/entities/animals/boss_centipede/orb_circleshot.xml", "data/entities/animals/boss_centipede/orb_homing_part.xml", "data/entities/animals/boss_centipede/orb_homing.xml", "data/entities/animals/boss_centipede/orb_mat_blood_gfx.xml", "data/entities/animals/boss_centipede/orb_mat_blood.xml", "data/entities/animals/boss_centipede/orb_mat_lava_gfx.xml", "data/entities/animals/boss_centipede/orb_mat_lava.xml", "data/entities/animals/boss_centipede/orb_mat_oil_gfx.xml", "data/entities/animals/boss_centipede/orb_mat_oil.xml", "data/entities/animals/boss_centipede/orb_mat_radioactive_gfx.xml", "data/entities/animals/boss_centipede/orb_mat_radioactive.xml", "data/entities/animals/boss_centipede/orb_polymorph.xml", "data/entities/animals/boss_centipede/orb_purple.xml", "data/entities/animals/boss_centipede/reference_point.xml", "data/entities/animals/boss_centipede/rewards/giant_dollar.xml", "data/entities/animals/boss_centipede/rewards/gold_reward.xml", "data/entities/animals/boss_centipede/rewards/reward_almostpacifist.xml", "data/entities/animals/boss_centipede/rewards/reward_clock.xml", "data/entities/animals/boss_centipede/rewards/reward_crown.xml", "data/entities/animals/boss_centipede/rewards/reward_dollar.xml", "data/entities/animals/boss_centipede/rewards/reward_kicksonly.xml", "data/entities/animals/boss_centipede/rewards/reward_minit.xml", "data/entities/animals/boss_centipede/rewards/reward_nohit.xml", "data/entities/animals/boss_centipede/rewards/reward_nolla.xml", "data/entities/animals/boss_centipede/rewards/reward_notinkeringofwands.xml", "data/entities/animals/boss_centipede/rewards/reward_nowands.xml", "data/entities/animals/boss_centipede/rewards/reward_peace.xml", "data/entities/animals/boss_centipede/rewards/reward_sun.xml", "data/entities/animals/boss_centipede/sampo_sprite.xml", "data/entities/animals/boss_centipede/sampo_working_sprite.xml", "data/entities/animals/boss_centipede/sampo_working.xml", "data/entities/animals/boss_centipede/sampo.xml", "data/entities/animals/boss_centipede/tail/tail_1_green.xml", "data/entities/animals/boss_centipede/tail/tail_1.xml", "data/entities/animals/boss_centipede/tail/tail_2_green.xml", "data/entities/animals/boss_centipede/tail/tail_2.xml", "data/entities/animals/boss_centipede/tail/tail_verlet_1.xml", "data/entities/animals/boss_centipede/tail/tail_verlet_2.xml", "data/entities/animals/boss_centipede/tail/tail.xml", "data/entities/animals/boss_centipede/verlet_chains/minion_tentacle_1.xml", "data/entities/animals/boss_centipede/verlet_chains/minion_tentacle_2.xml", "data/entities/animals/boss_centipede/verlet_chains/minion_tentacle_3.xml", "data/entities/animals/boss_centipede/verlet_chains/minion_tentacle_4.xml", "data/entities/animals/boss_centipede/verlet_chains/minion_tentacle_verlet_1.xml", "data/entities/animals/boss_centipede/verlet_chains/minion_tentacle_verlet_2.xml", "data/entities/animals/boss_centipede/verlet_chains/minion_tentacle_verlet_3.xml", "data/entities/animals/boss_centipede/verlet_chains/minion_tentacle_verlet_4.xml", "data/entities/animals/boss_centipede/verlet_chains/minion_tentacle.xml", "data/entities/animals/boss_centipede/verlet_chains/verlet_1_green.xml", "data/entities/animals/boss_centipede/verlet_chains/verlet_1.xml", "data/entities/animals/boss_centipede/verlet_chains/verlet_2_green.xml", "data/entities/animals/boss_centipede/verlet_chains/verlet_2.xml", "data/entities/animals/boss_centipede/verlet_chains/verlet_3_green.xml", "data/entities/animals/boss_centipede/verlet_chains/verlet_3.xml", "data/entities/animals/boss_centipede/verlet_chains/verlet_4_green.xml", "data/entities/animals/boss_centipede/verlet_chains/verlet_4.xml", "data/entities/animals/boss_centipede/verlet_chains/verlet_vine_long.xml", "data/entities/animals/boss_centipede/verlet_chains/verlet_vine_short.xml", "data/entities/animals/boss_centipede/verlet_chains/verlet_vine.xml", "data/entities/animals/boss_centipede/verlet_chains/vine_verlet_1.xml", "data/entities/animals/boss_centipede/verlet_chains/vine_verlet_2.xml", "data/entities/animals/boss_centipede/verlet_chains/vine_verlet_3.xml", "data/entities/animals/boss_centipede/verlet_chains/vine_verlet_4.xml", "data/entities/animals/boss_centipede/verlet_cord.xml", "data/entities/animals/boss_dragon.xml", "data/entities/animals/boss_fish/eye.xml", "data/entities/animals/boss_fish/fish_giga.xml", "data/entities/animals/boss_fish/orb_big_sprite.xml", "data/entities/animals/boss_fish/orb_big.xml", "data/entities/animals/boss_gate/gate_monster_a_glow.xml", "data/entities/animals/boss_gate/gate_monster_a.xml", "data/entities/animals/boss_gate/gate_monster_b_glow.xml", "data/entities/animals/boss_gate/gate_monster_b.xml", "data/entities/animals/boss_gate/gate_monster_c_glow.xml", "data/entities/animals/boss_gate/gate_monster_c.xml", "data/entities/animals/boss_gate/gate_monster_d_glow.xml", "data/entities/animals/boss_gate/gate_monster_d.xml", "data/entities/animals/boss_ghost/body.xml", "data/entities/animals/boss_ghost/boss_ghost_polyp.xml", "data/entities/animals/boss_ghost/boss_ghost.xml", "data/entities/animals/boss_ghost/eye.xml", "data/entities/animals/boss_ghost/ghost_spawn_check.xml", "data/entities/animals/boss_ghost/polyp_eye.xml", "data/entities/animals/boss_ghost/polyp.xml", "data/entities/animals/boss_ghost/pupil.xml", "data/entities/animals/boss_limbs/body.xml", "data/entities/animals/boss_limbs/boss_limbs_physics.xml", "data/entities/animals/boss_limbs/boss_limbs_trigger.xml", "data/entities/animals/boss_limbs/boss_limbs.xml", "data/entities/animals/boss_limbs/eyea.xml", "data/entities/animals/boss_limbs/eyeb.xml", "data/entities/animals/boss_limbs/hair1.xml", "data/entities/animals/boss_limbs/hair2.xml", "data/entities/animals/boss_limbs/hair3.xml", "data/entities/animals/boss_limbs/hair_piece_thin.xml", "data/entities/animals/boss_limbs/hair_piece.xml", "data/entities/animals/boss_limbs/limb_attacker.xml", "data/entities/animals/boss_limbs/limb_enemy_generic.xml", "data/entities/animals/boss_limbs/limb.xml", "data/entities/animals/boss_limbs/orb_boss_limbs.xml", "data/entities/animals/boss_limbs/orb_pink_big.xml", "data/entities/animals/boss_limbs/skull.xml", "data/entities/animals/boss_limbs/slime_boss_limbs.xml", "data/entities/animals/boss_limbs/slimeshooter_boss_limbs.xml", "data/entities/animals/boss_limbs/slimeshooter_boss.xml", "data/entities/animals/boss_meat/acidshot_slow.xml", "data/entities/animals/boss_meat/body.xml", "data/entities/animals/boss_meat/boss_meat.xml", "data/entities/animals/boss_meat/hair1.xml", "data/entities/animals/boss_meat/hair2.xml", "data/entities/animals/boss_meat/hair3.xml", "data/entities/animals/boss_meat/hair_piece_thin.xml", "data/entities/animals/boss_meat/hair_piece.xml", "data/entities/animals/boss_meat/knee.xml", "data/entities/animals/boss_meat/limb_a.xml", "data/entities/animals/boss_meat/limb_b.xml", "data/entities/animals/boss_meat/limb.xml", "data/entities/animals/boss_meat/orb_big.xml", "data/entities/animals/boss_meat/slime_boss_limbs.xml", "data/entities/animals/boss_pit/body.xml", "data/entities/animals/boss_pit/boss_pit_spawner.xml", "data/entities/animals/boss_pit/boss_pit.xml", "data/entities/animals/boss_pit/tentacle_1.xml", "data/entities/animals/boss_pit/tentacle_2.xml", "data/entities/animals/boss_pit/tentacle_3.xml", "data/entities/animals/boss_pit/tentacle_4.xml", "data/entities/animals/boss_pit/tentacle_verlet_1.xml", "data/entities/animals/boss_pit/tentacle_verlet_2.xml", "data/entities/animals/boss_pit/tentacle_verlet_3.xml", "data/entities/animals/boss_pit/tentacle_verlet_4.xml", "data/entities/animals/boss_pit/tentacle.xml", "data/entities/animals/boss_pit/wand.xml", "data/entities/animals/boss_robot/body.xml", "data/entities/animals/boss_robot/boss_robot.xml", "data/entities/animals/boss_robot/limb.xml", "data/entities/animals/boss_robot/rocket_roll.xml", "data/entities/animals/boss_robot/rocket.xml", "data/entities/animals/boss_spirit/boss_spirit_sprite.xml", "data/entities/animals/boss_spirit/countered_projectile_effect.xml", "data/entities/animals/boss_spirit/islandspirit.xml", "data/entities/animals/boss_spirit/orb.xml", "data/entities/animals/boss_spirit/spawner.xml", "data/entities/animals/boss_spirit/spawn_portal.xml", "data/entities/animals/boss_spirit/wisp.xml", "data/entities/animals/boss_wizard/bloodtentacle.xml", "data/entities/animals/boss_wizard/boss_wizard.xml", "data/entities/animals/boss_wizard/debuff_init.xml", "data/entities/animals/boss_wizard/debuff.xml", "data/entities/animals/boss_wizard/laser.xml", "data/entities/animals/boss_wizard/meteor.xml", "data/entities/animals/boss_wizard/orb_blood.xml", "data/entities/animals/boss_wizard/orb_death.xml", "data/entities/animals/boss_wizard/spawner.xml", "data/entities/animals/boss_wizard/statusburst.xml", "data/entities/animals/boss_wizard/summon.xml", "data/entities/animals/boss_wizard/wizard_body.xml", "data/entities/animals/boss_wizard/wizard_hand.xml", "data/entities/animals/boss_wizard/wizard_head.xml", "data/entities/animals/boss_wizard/wizard_helmet.xml", "data/entities/animals/boss_wizard/wizard_orb_blood.xml", "data/entities/animals/boss_wizard/wizard_orb_death.xml", "data/entities/animals/chest_leggy.xml", "data/entities/animals/chest_mimic.xml", "data/entities/animals/confusespirit.xml", "data/entities/animals/coward.xml", "data/entities/animals/crypt/acidshooter.xml", "data/entities/animals/crypt/barfer.xml", "data/entities/animals/crypt/crystal_physics.xml", "data/entities/animals/crypt/enlightened_alchemist.xml", "data/entities/animals/crypt/failed_alchemist.xml", "data/entities/animals/crypt/maggot.xml", "data/entities/animals/crypt/necromancer.xml", "data/entities/animals/crypt/phantom_a.xml", "data/entities/animals/crypt/phantom_b.xml", "data/entities/animals/crypt/skullfly.xml", "data/entities/animals/crypt/skullrat.xml", "data/entities/animals/crypt/tentacler_small.xml", "data/entities/animals/crypt/tentacler.xml", "data/entities/animals/crypt/thundermage.xml", "data/entities/animals/crypt/wizard_dark.xml", "data/entities/animals/crypt/wizard_neutral.xml", "data/entities/animals/crypt/wizard_poly.xml", "data/entities/animals/crypt/wizard_returner.xml", "data/entities/animals/crypt/wizard_tele.xml", "data/entities/animals/crypt/worm_skull.xml", "data/entities/animals/crypt/worm.xml", "data/entities/animals/crystal_physics.xml", "data/entities/animals/darkghost.xml", "data/entities/animals/deer.xml", "data/entities/animals/drone_lasership.xml", "data/entities/animals/drone_physics.xml", "data/entities/animals/drone_shield.xml", "data/entities/animals/drone.xml", "data/entities/animals/drunk/miner_chef.xml", "data/entities/animals/drunk/miner_fire.xml", "data/entities/animals/drunk/miner_weak.xml", "data/entities/animals/drunk/miner.xml", "data/entities/animals/drunk/scavenger_clusterbomb.xml", "data/entities/animals/drunk/scavenger_glue.xml", "data/entities/animals/drunk/scavenger_grenade.xml", "data/entities/animals/drunk/scavenger_heal.xml", "data/entities/animals/drunk/scavenger_invis.xml", "data/entities/animals/drunk/scavenger_leader.xml", "data/entities/animals/drunk/scavenger_mine.xml", "data/entities/animals/drunk/scavenger_poison.xml", "data/entities/animals/drunk/scavenger_shield.xml", "data/entities/animals/drunk/scavenger_smg.xml", "data/entities/animals/drunk/shotgunner_weak.xml", "data/entities/animals/drunk/shotgunner.xml", "data/entities/animals/drunk/sniper.xml", "data/entities/animals/duck.xml", "data/entities/animals/easter/sniper.xml", "data/entities/animals/eel.xml", "data/entities/animals/elk.xml", "data/entities/animals/ending_placeholder/boss_dragon_endcrystal.xml", "data/entities/animals/ending_placeholder/boss_limbs/body.xml", "data/entities/animals/ending_placeholder/boss_limbs/boss_limbs_physics.xml", "data/entities/animals/ending_placeholder/boss_limbs/boss_limbs.xml", "data/entities/animals/ending_placeholder/boss_limbs/eyea.xml", "data/entities/animals/ending_placeholder/boss_limbs/eyeb.xml", "data/entities/animals/ending_placeholder/boss_limbs/hair1.xml", "data/entities/animals/ending_placeholder/boss_limbs/hair2.xml", "data/entities/animals/ending_placeholder/boss_limbs/hair3.xml", "data/entities/animals/ending_placeholder/boss_limbs/hair_piece_thin.xml", "data/entities/animals/ending_placeholder/boss_limbs/hair_piece.xml", "data/entities/animals/ending_placeholder/boss_limbs/limb_attacker.xml", "data/entities/animals/ending_placeholder/boss_limbs/limb_enemy_generic.xml", "data/entities/animals/ending_placeholder/boss_limbs/limb.xml", "data/entities/animals/ending_placeholder/boss_limbs/orb_boss_limbs.xml", "data/entities/animals/ending_placeholder/boss_limbs/skull.xml", "data/entities/animals/ending_placeholder/boss_limbs/slime_boss_limbs.xml", "data/entities/animals/ending_placeholder/boss_limbs/slimeshooter_boss_limbs.xml", "data/entities/animals/ending_placeholder/boss_limbs/slimeshooter_boss.xml", "data/entities/animals/enlightened_alchemist.xml", "data/entities/animals/ethereal_being.xml", "data/entities/animals/failed_alchemist_b.xml", "data/entities/animals/failed_alchemist.xml", "data/entities/animals/firebug.xml", "data/entities/animals/firemage_weak.xml", "data/entities/animals/firemage.xml", "data/entities/animals/fireskull_weak.xml", "data/entities/animals/fireskull.xml", "data/entities/animals/fish_large.xml", "data/entities/animals/fish.xml", "data/entities/animals/flamer.xml", "data/entities/animals/fly.xml", "data/entities/animals/friend.xml", "data/entities/animals/frog_big.xml", "data/entities/animals/frog.xml", "data/entities/animals/fungus_big.xml", "data/entities/animals/fungus_giga.xml", "data/entities/animals/fungus_tiny.xml", "data/entities/animals/fungus.xml", "data/entities/animals/gazer.xml", "data/entities/animals/ghost.xml", "data/entities/animals/ghoul.xml", "data/entities/animals/giantshooter_weak.xml", "data/entities/animals/giantshooter.xml", "data/entities/animals/giant.xml", "data/entities/animals/goblin_bomb.xml", "data/entities/animals/healerdrone_physics.xml", "data/entities/animals/icemage.xml", "data/entities/animals/icer.xml", "data/entities/animals/iceskull.xml", "data/entities/animals/illusions/acidshooter.xml", "data/entities/animals/illusions/dark_alchemist.xml", "data/entities/animals/illusions/enlightened_alchemist.xml", "data/entities/animals/illusions/scavenger_grenade.xml", "data/entities/animals/illusions/scavenger_mine.xml", "data/entities/animals/illusions/shaman_wind.xml", "data/entities/animals/illusions/shaman.xml", "data/entities/animals/illusions/tank.xml", "data/entities/animals/illusions/tentacler.xml", "data/entities/animals/illusions/thundermage.xml", "data/entities/animals/illusions/wizard_swapper.xml", "data/entities/animals/illusions/worm_big.xml", "data/entities/animals/lasershooter.xml", "data/entities/animals/longleg.xml", "data/entities/animals/lukki/lukki_creepy_long.xml", "data/entities/animals/lukki/lukki_creepy.xml", "data/entities/animals/lukki/lukki_dark.xml", "data/entities/animals/lukki/lukki_feet/chest_limb_attacker.xml", "data/entities/animals/lukki/lukki_feet/chest_limb_left.xml", "data/entities/animals/lukki/lukki_feet/chest_limb_right.xml", "data/entities/animals/lukki/lukki_feet/chest_limb.xml", "data/entities/animals/lukki/lukki_feet/lukki_dark_limb_animated.xml", "data/entities/animals/lukki/lukki_feet/lukki_dark_sprite_emissive.xml", "data/entities/animals/lukki/lukki_feet/lukki_dark_sprite.xml", "data/entities/animals/lukki/lukki_feet/lukki_limb_animated.xml", "data/entities/animals/lukki/lukki_feet/lukki_limb_attacker_long2.xml", "data/entities/animals/lukki/lukki_feet/lukki_limb_attacker_long.xml", "data/entities/animals/lukki/lukki_feet/lukki_limb_attacker_minion.xml", "data/entities/animals/lukki/lukki_feet/lukki_limb_attacker_tiny.xml", "data/entities/animals/lukki/lukki_feet/lukki_limb_attacker.xml", "data/entities/animals/lukki/lukki_feet/lukki_limb_long2.xml", "data/entities/animals/lukki/lukki_feet/lukki_limb_long_animated.xml", "data/entities/animals/lukki/lukki_feet/lukki_limb_long.xml", "data/entities/animals/lukki/lukki_feet/lukki_limb_minion.xml", "data/entities/animals/lukki/lukki_feet/lukki_limb_tiny.xml", "data/entities/animals/lukki/lukki_feet/lukki_limb.xml", "data/entities/animals/lukki/lukki_feet/lukki_sprite_b.xml", "data/entities/animals/lukki/lukki_feet/lukki_sprite_creepy2.xml", "data/entities/animals/lukki/lukki_feet/lukki_sprite_creepy.xml", "data/entities/animals/lukki/lukki_feet/lukki_sprite_emissive_b.xml", "data/entities/animals/lukki/lukki_feet/lukki_sprite_emissive.xml", "data/entities/animals/lukki/lukki_feet/lukki_sprite_minion.xml", "data/entities/animals/lukki/lukki_feet/lukki_sprite_tiny.xml", "data/entities/animals/lukki/lukki_feet/lukki_sprite.xml", "data/entities/animals/lukki/lukki_feet/lukki_wiggle.xml", "data/entities/animals/lukki/lukki_longleg.xml", "data/entities/animals/lukki/lukki_tiny.xml", "data/entities/animals/lukki/lukki.xml", "data/entities/animals/lurker.xml", "data/entities/animals/maggot_tiny/maggot_tiny.xml", "data/entities/animals/maggot_tiny/orb.xml", "data/entities/animals/maggot.xml", "data/entities/animals/meatmaggot.xml", "data/entities/animals/mimic_physics.xml", "data/entities/animals/miner_chef.xml", "data/entities/animals/miner_fire.xml", "data/entities/animals/miner_hell.xml", "data/entities/animals/miner_santa.xml", "data/entities/animals/miner_weak.xml", "data/entities/animals/miner.xml", "data/entities/animals/miniblob.xml", "data/entities/animals/missilecrab.xml", "data/entities/animals/monk.xml", "data/entities/animals/necrobot_super.xml", "data/entities/animals/necrobot.xml", "data/entities/animals/necromancer_shop.xml", "data/entities/animals/necromancer_super.xml", "data/entities/animals/necromancer.xml", "data/entities/animals/parallel/alchemist/parallel_alchemist.xml", "data/entities/animals/parallel/alchemist/sprite.xml", "data/entities/animals/parallel/tentacles/parallel_tentacles.xml", "data/entities/animals/parallel/tentacles/sprite.xml", "data/entities/animals/parallel/tentacles/tentacle_1.xml", "data/entities/animals/parallel/tentacles/tentacle_2.xml", "data/entities/animals/parallel/tentacles/tentacle_3.xml", "data/entities/animals/parallel/tentacles/tentacle_4.xml", "data/entities/animals/parallel/tentacles/tentacle_verlet_1.xml", "data/entities/animals/parallel/tentacles/tentacle_verlet_2.xml", "data/entities/animals/parallel/tentacles/tentacle_verlet_3.xml", "data/entities/animals/parallel/tentacles/tentacle_verlet_4.xml", "data/entities/animals/parallel/tentacles/tentacle.xml", "data/entities/animals/pebble_physics.xml", "data/entities/animals/phantom_a.xml", "data/entities/animals/phantom_b.xml", "data/entities/animals/playerghost.xml", "data/entities/animals/rainforest/bloom.xml", "data/entities/animals/rainforest/coward.xml", "data/entities/animals/rainforest/flamer.xml", "data/entities/animals/rainforest/fly.xml", "data/entities/animals/rainforest/fungus.xml", "data/entities/animals/rainforest/scavenger_clusterbomb.xml", "data/entities/animals/rainforest/scavenger_grenade.xml", "data/entities/animals/rainforest/scavenger_heal.xml", "data/entities/animals/rainforest/scavenger_leader.xml", "data/entities/animals/rainforest/scavenger_mine.xml", "data/entities/animals/rainforest/scavenger_poison.xml", "data/entities/animals/rainforest/scavenger_smg.xml", "data/entities/animals/rainforest/shooterflower.xml", "data/entities/animals/rainforest/sniper.xml", "data/entities/animals/rat.xml", "data/entities/animals/robobase/drone_lasership.xml", "data/entities/animals/robobase/drone_shield.xml", "data/entities/animals/robobase/healerdrone_physics.xml", "data/entities/animals/robobase/monk.xml", "data/entities/animals/robobase/tank_super.xml", "data/entities/animals/robobase/turret_left.xml", "data/entities/animals/robobase/turret_right.xml", "data/entities/animals/roboguard_big.xml", "data/entities/animals/roboguard.xml", "data/entities/animals/scavenger_clusterbomb.xml", "data/entities/animals/scavenger_glue.xml", "data/entities/animals/scavenger_grenade.xml", "data/entities/animals/scavenger_heal.xml", "data/entities/animals/scavenger_invis.xml", "data/entities/animals/scavenger_leader.xml", "data/entities/animals/scavenger_mine.xml", "data/entities/animals/scavenger_poison.xml", "data/entities/animals/scavenger_shield.xml", "data/entities/animals/scavenger_smg.xml", "data/entities/animals/scorpion.xml", "data/entities/animals/shaman.xml", "data/entities/animals/sheep_bat.xml", "data/entities/animals/sheep_fly.xml", "data/entities/animals/sheep.xml", "data/entities/animals/shooterflower.xml", "data/entities/animals/shotgunner_hell.xml", "data/entities/animals/shotgunner_weak.xml", "data/entities/animals/shotgunner.xml", "data/entities/animals/skullfly.xml", "data/entities/animals/skullrat.xml", "data/entities/animals/skycrystal_physics.xml", "data/entities/animals/skygazer.xml", "data/entities/animals/slimeshooter_nontoxic.xml", "data/entities/animals/slimeshooter_weak.xml", "data/entities/animals/slimeshooter.xml", "data/entities/animals/slimespirit.xml", "data/entities/animals/sniper_hell.xml", "data/entities/animals/sniper.xml", "data/entities/animals/spearbot.xml", "data/entities/animals/special/minipit.xml", "data/entities/animals/special/verlet_chains/minion_tentacle_1.xml", "data/entities/animals/special/verlet_chains/minion_tentacle_2.xml", "data/entities/animals/special/verlet_chains/minion_tentacle_3.xml", "data/entities/animals/special/verlet_chains/minion_tentacle_4.xml", "data/entities/animals/special/verlet_chains/minion_tentacle_verlet_1.xml", "data/entities/animals/special/verlet_chains/minion_tentacle_verlet_2.xml", "data/entities/animals/special/verlet_chains/minion_tentacle_verlet_3.xml", "data/entities/animals/special/verlet_chains/minion_tentacle_verlet_4.xml", "data/entities/animals/special/verlet_chains/minion_tentacle.xml", "data/entities/animals/spitmonster.xml", "data/entities/animals/statue_physics.xml", "data/entities/animals/statue.xml", "data/entities/animals/tank_rocket.xml", "data/entities/animals/tank_super.xml", "data/entities/animals/tank.xml", "data/entities/animals/tentacler_small.xml", "data/entities/animals/tentacler.xml", "data/entities/animals/_test_walk.xml", "data/entities/animals/the_end/bloodcrystal_physics.xml", "data/entities/animals/the_end/gazer.xml", "data/entities/animals/the_end/skycrystal_physics.xml", "data/entities/animals/the_end/skygazer.xml", "data/entities/animals/the_end/spearbot.xml", "data/entities/animals/the_end/spitmonster.xml", "data/entities/animals/the_end/worm_end.xml", "data/entities/animals/the_end/worm_skull.xml", "data/entities/animals/thundermage_big.xml", "data/entities/animals/thundermage.xml", "data/entities/animals/thunderskull.xml", "data/entities/animals/turret_left.xml", "data/entities/animals/turret_right.xml", "data/entities/animals/ultimate_killer.xml", "data/entities/animals/vault/acidshooter.xml", "data/entities/animals/vault/assassin.xml", "data/entities/animals/vault/bigzombie.xml", "data/entities/animals/vault/blob.xml", "data/entities/animals/vault/coward.xml", "data/entities/animals/vault/drone_physics.xml", "data/entities/animals/vault/firemage.xml", "data/entities/animals/vault/flamer.xml", "data/entities/animals/vault/healerdrone_physics.xml", "data/entities/animals/vault/icer.xml", "data/entities/animals/vault/lasershooter.xml", "data/entities/animals/vault/maggot.xml", "data/entities/animals/vault/missilecrab.xml", "data/entities/animals/vault/roboguard.xml", "data/entities/animals/vault/scavenger_glue.xml", "data/entities/animals/vault/scavenger_grenade.xml", "data/entities/animals/vault/scavenger_heal.xml", "data/entities/animals/vault/scavenger_leader.xml", "data/entities/animals/vault/scavenger_mine.xml", "data/entities/animals/vault/scavenger_smg.xml", "data/entities/animals/vault/sniper.xml", "data/entities/animals/vault/tank_rocket.xml", "data/entities/animals/vault/tank_super.xml", "data/entities/animals/vault/tank.xml", "data/entities/animals/vault/tentacler_small.xml", "data/entities/animals/vault/tentacler.xml", "data/entities/animals/vault/thundermage.xml", "data/entities/animals/vault/thunderskull.xml", "data/entities/animals/vault/turret_left.xml", "data/entities/animals/vault/turret_right.xml", "data/entities/animals/vault/wizard_dark.xml", "data/entities/animals/wand_ghost_charmed.xml", "data/entities/animals/wand_ghost_with_sampo.xml", "data/entities/animals/wand_ghost.xml", "data/entities/animals/weakspirit.xml", "data/entities/animals/wizard_dark.xml", "data/entities/animals/wizard_hearty.xml", "data/entities/animals/wizard_homing.xml", "data/entities/animals/wizard_neutral.xml", "data/entities/animals/wizard_poly.xml", "data/entities/animals/wizard_returner.xml", "data/entities/animals/wizard_swapper.xml", "data/entities/animals/wizard_tele.xml", "data/entities/animals/wizard_twitchy.xml", "data/entities/animals/wizard_weaken.xml", "data/entities/animals/wolf.xml", "data/entities/animals/worm_big.xml", "data/entities/animals/worm_end.xml", "data/entities/animals/worm_skull.xml", "data/entities/animals/worm_tiny.xml", "data/entities/animals/worm.xml", "data/entities/animals/wraith_glowing.xml", "data/entities/animals/wraith_storm.xml", "data/entities/animals/wraith.xml", "data/entities/animals/zombie_weak.xml", "data/entities/animals/zombie.xml", }

-- Ugly but easy. 0 = not started, 1 = started, 2 = errored out, 3 = successfully completed
local status = 0

-- Only available in beta, I think
ModDoesFileExist = ModDoesFileExist or function(path) return ModTextFileGetContent(path) ~= nil end

-- Borrowed from grahamsdialogue mod with permission from authors (GrahamBurger and NathanSnail)
-- Thanks!
-- Reads an entity XML file and moves down to its base (and its base...) until a name is hopefully found
local function traverse_base_tree(file, is_recursing)
	if file:sub(1, 4) ~= "data" and file:sub(1, 4) ~= "mods" then return "" end -- the stupid api says bones exist but they can't be read.
	if not ModDoesFileExist(file) then return "" end
	local tree = nxml.parse(ModTextFileGetContent(file))
	local name = tree.attr.name
	if name ~= nil then
		if is_recursing and name:sub(1,8) == "$animal_" then
			return name
		else
			-- For this helper, we only want to print names that are *NOT* easily available in the game.
			-- If we found the name in the original file, i.e. we didn't need to access a <Base> file,
			-- EntityGetName() should work, and storing the mapping would be a waste of space and perhaps CPU time.
			return "__ignore__"
		end
	end
	for _, v in ipairs(tree.children) do
		if v.name == "Base" then
			return traverse_base_tree(v.attr.file, true)
		end
	end
	return ""
end

function OnModPostInit()
	log("Initializing damagelog-dev-helper; " .. tostring(#file_list) .. " files to process")

	local file_handle = io.open("mods/damagelog/files/additional_entities.lua", "w")

	if not file_handle then
		log("!!! Unable to open output file! Check path and permissions. Exiting!")
		status = 2
		return
	end

	file_handle:write("return {\n")
	status = 1

	for _, path in ipairs(file_list) do
		local name = traverse_base_tree(path, false)
		if #name > 0 and name ~= "__ignore__" then
			log(name .. " for " .. path)
			file_handle:write(string.format('    ["%s"] = "%s",\n', path, name))
		elseif name == "__ignore__" then
			log("Ignoring " .. path)
		else
			log("No name found for " .. path)
		end
	end

	file_handle:write("}\n")
	file_handle:close()
	status = 3

end

-- Ugly but easy. 0 = not started, 1 = started, 2 = errored out, 3 = successfully completed
function OnPlayerSpawned(player_entity)
	if status == 0 then
		log("processing hasn't started yet; check output folder (damagelog/files) soon...")
	elseif status == 1 then
		log("processing started but not completed yet; check output folder (damagelog/files) soon...")
	elseif status == 2 then
		log("processing failed!")
	else
		log("done processing entities! File is written and closed.")
	end
end